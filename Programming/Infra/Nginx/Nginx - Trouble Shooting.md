
## 포트로 연결되지 않도록 하기

Jenkins에 접근하기 위한 `jenkins.konggogi.store` 도메인을 만들었다.
보안을 위해 반드시 해당 도메인으로 HTTPS 프로토콜로 요청이 올 경우에만 접근 가능하도록 구현하고 싶었다.

그런데 이게 왠걸, `konggogi.store:8090`으로도 접근이 가능한 것이다..!!
EC2 ip에 대강 8090 포트만 붙이면 HTTP 연결로 Jenkins에 접근이 가능했다.

HTTP 프로토콜로 요청이 들어올 경우 에러 페이지로 이동하도록 설정했으나 제대로 작동하지 않았다.
8090 포트 자체로 접근하기 때문에 Nginx를 거치지 않는 것 같다는 확신이 들었다.

### 그러던 중 해결책을 발견했다. 

[nginx로는 포트를 막을 수 없나요?](https://okky.kr/questions/788421)

외부에서 해당 포트 자체에 접근할 수 없도록 막으면 되는 것이었다..!!

### UFW 설정 변경

UFW에서 ALLOW 해뒀던 8090 포트를 막았다.
그런데도 접근이 가능했다..!
아마 Docker가 UFW 설정을 무시하기 때문인 것 같다..
- 생각해보니 이러한 이유 때문에 ufw-docker를 사용했던게 기억이 났다!

### EC2 인바운드 규칙 편집

불현듯 EC2 인바운드 규칙이 남아있다는 것이 생각났다.
8090 포트와 관련된 인바운드 규칙을 삭제했다.

이제서야 8090 포트로의 접근이 막혔다!

### [[Reverse Proxy]]를 사용하여 Jenkins 접근

Nginx 리버스 프록시 설정을 통해, 8090 포트로 직접 접근이 아닌, `jenkins.konggogi.store`를 통해 간접적으로 접근하도록 하였다.

비로소 허용되지 않는 접근으로부터 서버를 지킬 수 있었다.

### 깨달은 점

EC2 인바운드 규칙이든 UFW든 무작정 포트를 열지 말자 (내 생각에는 22, 80, 443이면 충분한 것 같다)
##### 반드시 Nginx의 리버스 프록시를 이용해 SSL 인증된 사이트로 접근 할 수 있도록 한다!