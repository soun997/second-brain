## 😄글의 주제

**이전 글**
- [[EC2 다운그레이드]]

Swap 영역을 지정함으로써 t3.small에서 Jenkins로 인해 서버가 다운되는 것을 해결하였다.
또한 t3.medium에서 t3.small로 변경한 것이기 때문에 청구되는 요금 또한 절반으로 줄었다.

**그러나 t3.small 또한 월 17$로 결코 저렴한 비용은 아니다.**
게다가 t3.small을 사용하는 이유가 단지 Jenkins를 돌리기 위해서라면 Jenkins 외의 다른 대안을 찾는 것이 더 이득일 수도 있다.

이에 대한 대안으로 Jenkins를 **Github Actions로 마이그레이션**하고, 우리 서비스에 적당한 인스턴스가 무엇인지 다시 고민해보려고 한다.


## 🤔또 다른 대안, Github Actions

먼저 제일 중요한 문제인 과금 정책을 확인해보았다.

![[Pasted image 20240310014922.png]]
ref) [GitHub Actions 요금 청구 정보](https://docs.github.com/ko/billing/managing-billing-for-github-actions/about-billing-for-github-actions)

무료라니..!

### Why, Github Actions?

가장 매력이 있었던 조건은 무료임에도 **VM을 제공**해준다는 것이었다.

**Jenkins는 자체적으로 호스팅**해주어야 했기 때문에 안 그래도 부족한 인스턴스의 자원을 잡아먹었다.
그러한 특성 때문에 인스턴스를 다운그레이드하면서 빌드에 소요되는 시간 또한 늘어났다.

빌드에 소요되는 시간이 늘어난다는 것은, 그 시간 동안 개발서버에 접근할 수 없다는 뜻이다.
5분이 결코 긴 시간은 아니지만, 짧은 시간도 아니다. 
- 서버 가용 시간이 줄어들면 팀의 생산성이 떨어진다.

Github Actions으로 이전한다면 빌드에 소요되는 시간을 줄일 수 있을 것이라고 예상했다.


## 🛠️Github Actions 적용기

### 반드시 제공해야 하는 기능

1. PR이 올라오면 merge 가능한 상태인지 테스트한다.
2. PR이 머지되면 빌드 과정을 거쳐서 배포한다.
3. 배포가 완료되면 서버 가용성 확인을 위해 Health Check를 시행한다.
4. CI, 배포 워크플로가 끝나면 팀 Discord로 결과를 발송한다.

### 달라진 점

**Jenkins**
- 배포 서버에서 함께 돌렸기 때문에, 서버에 설치된 docker를 공유하여 빌드 명령을 실행했다.

**Github Actions**
- VM에서 빌드한 후 Docker hub에 이미지를 올린다.
- SSH 명령을 통해 Docker hub의 이미지를 pull하고, 배포 서버에서 컨테이너를 실행한다.

## 😎결과

[[Github Actions 적용기]]

많은 삽질 끝에, 기존의 Jenkins 파이프라인을 Github Actions 워크플로로 완전하게 옮길 수 있었다.

빌드에 소요되는 시간도 약 80% 감소했다. (289s ➡️ 157s)
더 이상 `t3.small`를 사용할 필요가 없어졌기 때문에 `t3.micro`로 한번 더 다운그레이드 했다.

## ✅결론

### 정리

Jenkins에서 Github Actions으로 마이그레이션 하면서
처음과 비교했을 때, AWS 청구요금을 1/4로 줄일 수 있었다. ($34 ➡️ $9)

게다가 **빌드 속도까지 80% 정도 향상**되어 팀의 생산성에 큰 기여를 했다.

**서비스에 알맞는 아키텍처 선택하는 기준에 대하여 조금 갈피가 잡힌 것 같다.**
앞으로 사이드 프로젝트를 할 때는 가볍게 t3.micro 정도로 사용하면 될 것 같다!!

