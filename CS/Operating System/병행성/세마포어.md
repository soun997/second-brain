>Semaphore

상호 배제를 운영체제, 프로그래밍 언어 수준에서 지원하는 방법 중 하나이다.

한 프로세스가 특정 시그널(신호)를 수신할 때까지 대기한다.
- **블록(수면, P연산)** 과 **깨움(V 연산)** 두 상태와 이와 관련된 연산이 있다.
- 이러한 상태를 판단하기 위해 사용하는 변수를 **세마포어(사용 가능한 자원의 개수, S)** 라고 한다.


## 세마포어 연산

### 세마포어 초기화

세마포어의 값을 음이 아닌 값으로 초기화한다.
복수 개의 프로세스가 [[임계영역]]에 진입 가능하다.

### `semWait(x)` 연산 (P 연산)

1. 해당 세마포어 x값을 감소시킨다.
2. 감소된 값이 음수이면 호출한 프로세스는 블록된다.
3. 감소된 값이 0 또는 양수면 프로세스는 임계영역에 진입해 수행된다.

### `semSignal(x)` 연산 (V 연산)

1. 해당 세마포어 x값을 증가시킨다.
2. 증가된 값이 0, 음수이면(블록된 프로세스가 존재하면) 블록된 프로세스를 깨워 준비큐로 보낸다.
3. 증가된 값이 양수이면 블록된 프로세스가 없으므로 그냥 종료한다.


## 세마포어의 특징

- 프로세스의 블록 여부를 세마포어를 감소시키기 전까지 알 수 없다.
- 세마포어가 증가되어 블록 상태를 해제할 경우, 블록되어 있는 프로세스가 여러 개이면 어떤 프로세스가 즉시 수행될 지 알 수 없다.
- 세마포어 시그널을 보낼 때 블록 중인 다른 프로세스가 존재하는지 알 필요가 없다.


## 세마포어의 종류

### 범용 세마포어

- "Counting Semaphore"라고도 한다.
- 초기 설정되는 세마포어의 값 만큼 개수의 프로세스가 임계영역에 동시에 진입할 수 있다.

### 이진 세마포어

- "Binary Semaphore"라고도 한다.
- 세마포어의 초기치는 1이며 0과 1의 값만을 가진다.
- Lock을 설정한 프로세스와 해제하는 프로세스가 다를 수도 있다.
- 주로 [[동기화]]의 목적으로 사용한다.

#### 뮤텍스 락

- 이진 세마포어와 유사하지만, Lock을 획득한 프로세스 만이 Lock을 해제할 수 있다.
- 뮤텍스 락이 걸려있으면 이를 부르는 프로세스는 Lock의 해제를 기다리며 바쁜 대기를 한다.
	- [[Spin Lock]]
- 진정한 의미의 세마포어는 아니지만, 동기화에 유용한 기법이다. 
	- 독점적 사용 권한의 획득을 목표로 한다.


## 세마포어의 활용

#### 한 프로세스 내에서 P연산, V연산을 모두 갖는 경우

- 임계영역을 한 순간에 독점적으로 사용하는 경우이다.

#### 한 프로세스 내에서 P연산만, 다른 프로세스 내에서는 V연산만 사용하는 경우

- 임계영역을 서로 공유하면서 처리가 되는 경우이다.
- 세마포어의 가장 일반적인 활용법이다.
- 동기화를 할 경우에 많이 사용한다.
	- 주로 이진 세마포어를 사용
