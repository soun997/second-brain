## 페이징

**가상메모리**(디스크)는 **고정크기의 페이지로 분할**되고, **물리메모리**(주기억장치)는 **페이지 크기의 프레임(페이지 프레임)들로 분할**된다. (페이지 크기 = 프레임 크기)

### 페이지 테이블

페이지 테이블은 프로세스마다 하나씩 생성된다.

#### 가상주소
- <mark style="background: #FFB8EBA6;">가상페이지 번호</mark>
- <mark style="background: #FFF3A3A6;">가상페이지 오프셋</mark>

#### 페이지 테이블
- <mark style="background: #FFB8EBA6;">페이지 번호</mark>
- 유효비트 (0: 주기억장치에 적재 X, 1: 주기억장치에 적재 O)
- 변경비트
	- 페이지에 올라온 후 데이터 변경이 있었는지 알려주는 비트
- 접근비트
	- 페이지에 올라온 후 사용한 적이 있는지 알려주는 비트
- 주소 필드
	- 디스크 주소
	- <mark style="background: #FFB86CA6;">페이지 프레임 번호</mark>

#### 물리주소
- <mark style="background: #FFB86CA6;">페이지 프레임 번호</mark>
- <mark style="background: #FFF3A3A6;">가상페이지 오프셋</mark>

### 페이지 테이블 크기

가상주소공간의 크기가 커질 수록 페이지 테이블의 크기가 증가한다.
- 페이지의 최대 개수만큼의 PTE(Page Table Entry)가 필요하다.
- 페이지 테이블 검색 시, 이를 주기억장치에 적재하기 때문에 **주기억장치에는 보다 큰 페이지 테이블 적재 공간이 필요해지는 문제 발생**

#### n-단계 계층구조
- 페이지 테이블을 다단계로 만들고, 기본이 되는 **루트 페이지 테이블만 주기억장치에 상주시키고**, 하위 단계 페이지 테이블은 가상메모리 공간에 위치시킨다.

#### 역페이지테이블
- 개수가 적은 프레임 메모리를 중심으로 검색
- 운영체제는 모든 프로세스가 공유하는 역페이지 테이블을 별도로 생성한다.
	- 프레임 당 하나의 PTE로 역페이지 테이블을 구성하고 이를 주기억장치에 위치시킨다.
	- PTE의 개수는 물리메모리의 프레임 개수와 같다. (물리메모리를 그대로 사용)
- MMU는 역페이지 테이블 내에서 페이지 번호를 검색하고, 존재한다면 연결되어 있는 프레임 번호를 바로 참고한다.
- 하나의 프레임을 여러 프로세스가 이용할 수 있으므로 검색 시에 프로세스 ID도 확인해야 한다.
	- 해싱기법(=연결기법)을 사용하여 PTE 안에 짧은 체인을 생성한다. (충돌 예방)
- 기존의 페이지 테이블에서 PTE를 인덱싱하는 방식과 달리 순차 탐색하기 때문에 `O(n)`의 시간복잡도가 소요된다.
	- 검색속도를 위해 연관검색 또는 해시(hash)함수를 이용한다.

#### TLB(Translation Lookahead Buffer)
- 최근에 처리된 페이지 테이블의 정보를 갖는 고속 캐시
- 페이지 테이블에 접근하지 않고 고속 캐시로 빠르게 처리하는 것 (1번의 주기억장치 접근)

##### TLB에 대한 연관사상
- TLB 내에 원하는 페이지 번호가 있는지는 연관사상 방식으로 검색한다. (연관 검색)
	- 모든 페이지 번호들이 존재하는 것은 아니기 때문에, 빠른 연관메모리와 하드웨어의 도움을 받아 빠르게 검색한다.

##### 연관메모리
- 연관 기억 장치 또는 내용 지정 메모리 (CAM: Content Addressable Memory)
- 병렬 판독 회로를 내장하고 있어서 한 번에 전체의 내용의 비교 가능 (m라인을 한꺼번에 비교)
	- 캐시 메모리보다 훨씬 빠르지만 가격이 매우 비싸다.

### 페이지 크기

#### 작은 크기의 페이지
- 페이지 테이블의 크기 증가
- 페이지의 부재 비율 상승(복수 폴트)
- 장기적 관점으로는 페이지 부재 비율 감소
	- 실제로 사용되는 작은 조각들이 많이 존재
- 내부 단편화 감소
- 디스크 입출력 증가

#### 큰 크기의 페이지
- 페이지 테이블의 크기 감소
- 페이지 부재 비율 감소(복수 폴트)
- 장기적 관점으로는 페이지 부재 비율 증가
	- 큰 덩어리 몇 개만이 존재하기 때문이다.
- 내부 단편화 증가
- 디스크 입출력 감소